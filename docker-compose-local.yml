---

nginx:
    image: abaco/nginx$TAG
    volumes:
        - ./local-dev.conf:/etc/service.conf
    ports:
        - "8000:80"

reg:
    image: abaco/core$TAG
    ports:
        - "5000:5000"
    volumes:
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    environment:
        server: dev
        api: reg
        mongo_password:

mes:
    image: abaco/core$TAG
    volumes:
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    ports:
        - "5001:5000"
    environment:
        server: dev
        api: mes
        mongo_password:

agavemes:
    image: abaco/core$TAG
    volumes:
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    ports:
        - "5002:5000"
    environment:
        server: dev
        api: agavemes
        mongo_password:

admin:
    image: abaco/core$TAG
    volumes:
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    ports:
        - "5003:5000"
    environment:
        server: dev
        api: admin
        mongo_password:

spawner:
    image: abaco/core$TAG
    command: "python3 -u /actors/spawner.py"
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    environment:
        abaco_conf_host_path: ${abaco_path}/local-dev.conf
        _abaco_secret: 123
        mongo_password:

clientg:
    image: abaco/core$TAG
    command: "python3 -u /actors/clients.py"
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    environment:
        abaco_conf_host_path: ${abaco_path}/local-dev.conf
        _abaco_secret: 123
        # add the following pair of credentials for each tenant wanting client generation
        _abaco_TACC-PROD_username: impersadmin
        _abaco_TACC-PROD_password: nVXGPbNeyG3QPqZljd3tXccNeqN
        mongo_password:

health:
    image: abaco/core$TAG
    command: /actors/health_check.sh
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./local-dev.conf:/etc/service.conf
        - ./abaco.log:/var/log/service.log
    environment:
        mongo_password:
